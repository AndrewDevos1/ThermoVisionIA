<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Pagina de Login</title>
    <meta name="description" content="Tela de Login"/>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body>

    <div class="login-container">
        <div class="cartao-login">

            <div class="cabecalho-login">
                <h1>Bem-vindo de volta</h1>
                <p>Entre com suas credenciais para acessar sua conta</p>

                {% with mensagens = get_flashed_messages() %}
                    {% if mensagens %}
                        <ul class="ul-flashed-messages">
                    {% for mensagem in mensagens %}
                                <li class="mensagem-validacao">{{ mensagem }}</li>
                            {% endfor %}
                        </ul>
                    {% endif %}
                {% endwith %}
            </div>


            <form id="loginFormulario" class="login-formulario" autocomplete="off" method="POST">
                <div class="item-formulario">
                    <label for="usuario">Nome de usu√°rio</label>
                    <input type="text" id="usuario" name="usuario" placeholder="Digite o seu nome de usu√°rio" required>
                </div>

                <div class="item-formulario">
                    <label for="senha">Senha</label>
                    <div class="input-senha">
                        <input type="password" id="senha" name="senha" placeholder="Digite sua senha" required>
                        <button type="button" id="toggleSenha" class="btn-olho" aria-label="Mostrar ou ocultar senha">üëÅ</button>
                    </div>
                </div>

                <button type="submit" class="btn">
                    Entrar
                </button>

            </form>

            <div class="divider">
                <span>ou</span>
            </div>

            <a href="{{ url_for('tela_cadastro') }}" class="btn btn-criarConta link-criarConta" id="criarConta">
                Criar conta
            </a>

            <div class="login-rapido">
                <h2>Login r√°pido</h2>
                <p class="descricao-rapida">Selecione um usu√°rio j√° cadastrado para preencher login e senha.</p>
                <div id="lista-rapida" class="lista-rapida"></div>
                <div id="status-rapido" class="status-rapido"></div>
            </div>

        </div>
    </div>
    <script>
        document.addEventListener("DOMContentLoaded", () => {
            const toggleSenha = document.getElementById("toggleSenha");
            const inputSenha = document.getElementById("senha");
            if (toggleSenha && inputSenha) {
                toggleSenha.addEventListener("click", () => {
                    const isPassword = inputSenha.type === "password";
                        inputSenha.type = isPassword ? "text" : "password";
                        toggleSenha.textContent = isPassword ? "üëÅ" : "üëÅ‚Äçüó®";
                    });
            }

            const lista = document.getElementById("lista-rapida");
            const status = document.getElementById("status-rapido");
            const inputUser = document.getElementById("usuario");

            function setStatus(msg, isError = false) {
                if (!status) return;
                status.textContent = msg;
                status.className = "status-rapido " + (isError ? "erro" : "ok");
            }

            async function carregarUsuarios() {
                try {
                    const resp = await fetch("/usuarios/sugeridos");
                    const data = await resp.json();
                    if (!data.success) {
                        setStatus(data.message || "N√£o foi poss√≠vel carregar usu√°rios.", true);
                        return;
                    }
                    if (!data.users || data.users.length === 0) {
                        setStatus("Nenhum usu√°rio cadastrado para login r√°pido.");
                        return;
                    }
                    lista.innerHTML = "";
                    data.users.forEach((u) => {
                        const btn = document.createElement("button");
                        btn.type = "button";
                        btn.className = "btn-rapido";
                        btn.textContent = `${u.nome} (${u.email})`;
                        btn.addEventListener("click", () => {
                            if (inputUser) inputUser.value = u.nome;
                            if (inputSenha) inputSenha.value = u.senha || "";
                            setStatus(`Credenciais de ${u.nome} preenchidas.`);
                        });
                        lista.appendChild(btn);
                    });
                    setStatus(`Login r√°pido dispon√≠vel para ${data.users.length} usu√°rio(s).`);
                } catch (e) {
                    setStatus("Erro ao carregar usu√°rios.", true);
                }
            }

            carregarUsuarios();
        });
    </script>
</body>
</html>
